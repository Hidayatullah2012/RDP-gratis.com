name: Free RDP by GitHub Actions  

on:  
  workflow_dispatch  

jobs:  
  build:  
    runs-on: windows-latest  

    steps:  
    - name: Enable RDP Access  
      run: |  
        net user github Password123 /add  
        net localgroup administrators github /add  
        reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f  
        Enable-PSRemoting -Force  
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "UserAuthentication" -Value 0  
        netsh advfirewall firewall set rule group="Remote Desktop" new enable=yes  
    - name: Setup Ngrok  
      run: |  
        Invoke-WebRequest -Uri "https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-windows-amd64.zip" -OutFile "ngrok.zip"  
        Expand-Archive ngrok.zip  
        .\ngrok\ngrok.exe authtoken ${{ secrets.NGROK_AUTH_TOKEN }}  
        Start-Process -NoNewWindow -FilePath ".\ngrok\ngrok.exe" -ArgumentList "tcp 3389"
